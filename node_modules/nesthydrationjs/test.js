'use strict';

var NestHydrationJS = require('./nesthydrationjs');
var _ = require('lodash');

var table = [
	{bookTitle: 'Anathem', bookId: 1, authorId: 1, authorName: 'Neal Stephenson'},
	{bookTitle: 'Seveneves', bookId: 2, authorId: 1, authorName: 'Neal Stephenson'}
];
var definition = [{
	name: {column: 'authorName'},
	id: {column: 'authorId', id: true},
	books: [{
		title: {column: 'bookTitle'},
		id: {column: 'bookId', id: true}
	}]
}];
console.log(JSON.stringify(NestHydrationJS.nest(table, definition), null, '\t'));

var table = [
	{'_author_books__title': 'Anathem', '_author_books__id___ID___NUMBER': '1', '_author_id___NUMBER___ID': '1', '_author_name': 'Neal Stephenson'},
	{'_author_books__title': 'Seveneves', '_author_books__id___ID___NUMBER': '2', '_author_id___NUMBER___ID': '1', '_author_name': 'Neal Stephenson'}
];
var table = [
	{'_name': 'Neal Stephenson', '_id___NUMBER___ID': '1', '_books__title': 'Anathem', '_books__id___ID___NUMBER': '1'},
	{'_name': 'Neal Stephenson', '_id___NUMBER___ID': '1', '_books__title': 'Seveneves', '_books__id___ID___NUMBER': '2'}
];
var table = [
	{'_id___NUMBER___ID': '1', '_name': 'Neal Stephenson', '_books__title': 'Anathem', '_books__id___ID___NUMBER': '1'},
	{'_id___NUMBER___ID': '1', '_name': 'Neal Stephenson', '_books__title': 'Seveneves', '_books__id___ID___NUMBER': '2'}
];
var definition = NestHydrationJS.structPropToColumnMapFromColumnHints(_.keys(table[0]));
console.log(JSON.stringify(definition, null, '\t'));

console.log(JSON.stringify(NestHydrationJS.nest(table, definition), null, '\t'));
